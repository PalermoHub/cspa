<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mappa Zornade PACS - Centro Storico Palermo</title>
    <!-- Includi MapLibre GL CSS -->
    <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css " rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Includi MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js "></script>
    <!-- Includi PMTiles JS -->
    <script src="https://unpkg.com/pmtiles/dist/pmtiles.js "></script>
    <script>
        // Initialize the PMTiles protocol
        const PMTiles = window.PMTiles; // Access the PMTiles class from the global scope
        maplibregl.addProtocol("pmtiles", (params, callback) => {
            const pmtiles = new PMTiles(params.url);
            pmtiles.getTile(params.z, params.x, params.y).then((tile) => {
                if (tile) {
                    callback(null, { data: tile.data, headers: {} });
                } else {
                    callback(new Error("Tile not found"));
                }
            });
        });

        // Coordinate del centro storico di Palermo
        const centerPalermo = [13.361389, 38.115556]; // Longitudine, Latitudine

        // Creazione della mappa
        const map = new maplibregl.Map({
            container: 'map', // ID del contenitore della mappa
            style: {
                version: 8,
                sources: {
                    osm: {
                        type: "raster",
                        tiles: ["https://tile.openstreetmap.org/ {z}/{x}/{y}.png"],
                        tileSize: 256,
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright ">OpenStreetMap</a> contributors'
                    },
                    zornade_pacs: {
                        type: "vector",
                        url: "pmtiles://https://palermohub.github.io/cspa/dati/zornade_pacs.pmtiles "
                    }
                },
                layers: [
                    {
                        id: "osm-layer",
                        type: "raster",
                        source: "osm"
                    },
                    {
                        id: "catasto",
                        type: "fill",
                        source: "zornade_pacs",
                        "source-layer": "zornade_pacs", // Nome del layer nei dati PMTiles
                        paint: {
                            "fill-color": "#ffcc00", // Colore dei poligoni
                            "fill-opacity": 0.6 // Opacit√†
                        }
                    }
                ]
            },
            center: centerPalermo, // Centro della mappa
            zoom: 14 // Livello di zoom iniziale
        });

        // Aggiungi controlli alla mappa
        map.addControl(new maplibregl.NavigationControl());
        map.addControl(new maplibregl.ScaleControl());
    </script>
</body>
</html>